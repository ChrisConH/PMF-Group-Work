---
title: "Homework assignment 1. Programación y modelación financiera (PMF)"
author: "XXXX XXXX, Lara Weitgasser A01759114"
date: "8/29/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyquant)
library(ggplot2)
library(quantmod)
library(finreportr)
library(tibble)
library(tbl2xts)
library(dplyr)
library(lazyeval)
```

## From prices to returns
At first we loaded and plotted the data for the four companies Amazon, Facebook, Google and Netflix for the timeframe 2016-12-30 to 2021-07-31 in order to compare them to the FANG dataset that ends in 2016.

```{r cars}
#Plot: Amazon, Facebook, Google and Netflix 2016-12-30 to 2021-07-31
Stock_AFGN <- tq_get(c("AMZN","FB","GOOG","NFLX"))%>%
     group_by(symbol) %>%
     ggplot(aes(x = date, y = adjusted, color = symbol)) +
     geom_line(size = 1) +
     coord_x_date(xlim = c("2016-12-30","2021-07-31"))+
     labs(title = "Daily stock prices - 2016-12-30 to 2021-07-31",
          x = "", y = "Adjusted prices", color = "") +
     scale_y_continuous(labels = scales::dollar) +
     theme_tq() + scale_color_tq()
Stock_AFGN
```
As this plot distorts the perspective on the stock market of the four companies, the next plot shows the four companies separated in order to make comparisons easier and valuable.

```{r}
#Amazon, Facebook, Google and Netflix 2016-12-30 to 2021-07-31
Stock_AFGN <- tq_get(c("AMZN","FB","GOOG","NFLX"))%>%
     group_by(symbol) %>%
     ggplot(aes(x = date, y = adjusted, color = symbol)) +
     geom_line(size = 1) +
     coord_x_date(xlim = c("2016-12-30","2021-07-31"))+
     labs(title = "Daily stock prices - 2016-12-30 to 2021-07-31",
          x = "", y = "Adjusted prices", color = "") +
        facet_wrap(~ symbol, ncol = 2, scales = "free_y") +
     scale_y_continuous(labels = scales::dollar) +
     theme_tq() + scale_color_tq()
Stock_AFGN
```
The above plot has the strength of showing the companies separated, however, to make a good comparison, it is important to look at annual returns which is shown below.

```{r}
#Annual returns of Amazon, Facebook, Google and Netflix from 2017 to 2021
Stock_AFGN_annual_returns <- tq_get(c("AMZN","FB","GOOG","NFLX"))%>%
     group_by(symbol) %>%
        filter(date>"2016-12-30")%>%
        tq_transmute(select = adjusted,
        mutate_fun = periodReturn,
        period = "yearly",
        type = "arithmetic")

Stock_AFGN_annual_returns
```


```{r}
Stock_AFGN_annual_returns %>%
ggplot(aes(x = date-365, y = yearly.returns, fill = symbol)) +
geom_col() +
geom_hline(yintercept = 0, color = palette_light()[[1]]) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Annual Returns: Amazon, Facebook, Google and Netflix from 2017 to 2021",
y = "Annual Returns", x = "") +
facet_wrap(~ symbol, ncol = 2, scales = "free_y") +
theme_tq() + scale_fill_tq()
```


```{r}
#Cumulative Returns
Stock_AFGN_annual_cum_returns <- Stock_AFGN_annual_returns %>%
mutate(cr = 100*cumprod(1 + yearly.returns)) %>%
# Plot the results.
ggplot(aes(x = date-365, y = cr, fill = symbol)) + geom_col() +
labs(title = "Yearly cumulative USD returns.",
subtitle = "100 USD investment growth from 2016-12-30 to 2021-07-31",
x = "", y = "USD value at the end of the year", color = "") +
scale_y_continuous(labels = scales::dollar) +
facet_wrap(~ symbol, ncol = 2, scales = "free_y") +
theme_tq() + scale_color_tq()
Stock_AFGN_annual_cum_returns
```


```{r}
# Monthly returns.
Stock_AFGN_monthly_returns <- tq_get(c("AMZN","FB","GOOG","NFLX"))%>%
     group_by(symbol) %>%
        filter(date>"2016-12-30")%>%
        tq_transmute(select = adjusted,
        mutate_fun = periodReturn,
        period = "monthly",
        type = "arithmetic")
# Plot the results.
ggplot(Stock_AFGN_monthly_returns, aes(x = date-12,
y = monthly.returns, fill = symbol)) +
geom_col() +
geom_hline(yintercept = 0, color = palette_light()[[1]]) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Amazon, Facebook, Google and Netflix: Monthly Returns", y = "Monthly Returns",
x = "") +
facet_wrap(~ symbol, ncol = 2, scales = "free_y") +
theme_tq() + scale_fill_tq()
```


```{r}
# Calculate monthly cumulative returns.
Stock_AFGN_monthly_cum_returns <- Stock_AFGN_monthly_returns %>%
mutate(cr = 100 * cumprod(1 + monthly.returns))
# Plot results.
ggplot(Stock_AFGN_monthly_cum_returns, aes(x = date-12, y = cr,
color = symbol)) +
geom_line(size = 1) +
labs(title = "Monthly cumulative USD returns.",
subtitle = "100 USD investment growth from 2016-12-30 to 2021-07-31",
x = "", y = "USD value at the end of the year",
color = "") +
scale_y_continuous(labels = scales::dollar) +
theme_tq() + scale_color_tq()
```


```{r}
# Plot results.
ggplot(Stock_AFGN_monthly_cum_returns, aes(x = date-12, y = cr,
color = symbol)) +
geom_line(size = 1) +
labs(title = "Monthly cumulative USD returns.",
subtitle = "100 USD investment growth from 2016-12-30 to 2021-07-31",
x = "", y = "USD value at the end of the year",
color = "") +
scale_y_continuous(labels = scales::dollar) +
facet_wrap(~ symbol, ncol = 2, scales = "free_y") +
theme_tq() + scale_color_tq()
```


```{r}
# Density plots.
ggplot(Stock_AFGN_monthly_returns, aes(x = monthly.returns,
fill = symbol)) +
geom_density(alpha = 0.5) +
geom_hline(yintercept = 0, color = palette_light()[[1]]) +
labs(title = "Amazon, Facebook, Google and Netflix: Charting the Monthly Returns",
x = "Monthly Returns", y = "Density") + xlim(-0.3, 0.9) +
theme_tq() + scale_fill_tq()
```


```{r}
# Density plots.
ggplot(Stock_AFGN_monthly_returns, aes(x = monthly.returns,
fill = symbol)) +
geom_density(alpha = 0.5) +
geom_hline(yintercept = 0, color = palette_light()[[1]]) +
labs(title = "Amazon, Facebook, Google and Netflix: Charting the Monthly Returns",
x = "Monthly Returns", y = "Density") + xlim(-0.3, 0.9) +
theme_tq() + scale_fill_tq() + facet_wrap(~ symbol, ncol = 2)
```



```{r}
# Calculate relevant statistics.
Stock_AFGN_stats <- Stock_AFGN_monthly_returns %>%
summarise(mean = mean(monthly.returns), sd = sd(monthly.returns),
sr = mean/sd, iqr = IQR(monthly.returns))
Stock_AFGN_stats
```


```{r}
Stock_AFGN_stats %>%
ggplot(aes(x = sd, y = mean, color = symbol)) +
geom_point(size = 5) +
geom_text(aes(label = paste0(round(sr, 3))),
vjust = 2, color = "black", size = 3.5) +
xlim(0.04, 0.18) + ylim(0.01, 0.06) +
labs(title = "XXXX",
subtitle = "Numerical values represent return per unit of risk.",
x = "Risk", y = "Return") + theme_tq()
```


```{r}
# Create random assets.
less_risky <- data.frame(length = rnorm(10000, 0, 1))
more_risky <- data.frame(length = rnorm(10000, 0, 2))
# Name random assets.
less_risky$asset <- 'Less risky asset'
more_risky$asset <- 'Riskier asset'
assets <- rbind(less_risky, more_risky)
# Plot the assets.
ggplot(assets, aes(length, fill = asset)) +
geom_density(alpha = 0.5, adjust = 3)
```

